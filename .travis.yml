env:
  global:
  # Mongo 
  #  - secure: "nWMc0MVWjl0W7oCwY+yId4DFEcYDhLkZvRDbV4qlEf2Hu8Aps4rFS+NDJKrbtFkDm06OEyDm6EFKj8qcILTUEAq37s7g+hjxhmkcX5ZjIsVNmGcbNTzGSM+YGXBP62blUG1frXGIw5UCavrb7dGxXq3+vaL0tSok9b7djAFHxS0Z+/s6MEj9t3Z9d0UMnCMmiGkQmaaH922omA3de4AE5zuCHXbN7uzrVU51hnGf3dBCampIPWw02aaMcoKjCOMKu7o6CzErxj88kZEVVZJUqq9v4WNcj1X9hNOJxi/rzkYyVvROhcqG4Oy62rGZKt++ZVyIAOfpOEFGxJYCjbosdEBf8pTMrcFQwcfIyH/kwiNFRzieBkuolB3d8Hxp1EvoIKOqeeR4wDYs8d42ntwR3SJvEDlejyERTqOvSrPx3UOwIP+Dtd9gDed1MpZwkgzudzxV0X2LX/SN/DW9uRsl0mzpOixAQWgHGqbunIeWy0GjVDbwtDIxxpOHn92j1gYTj4Lx1P5WlCAh5dlTUPl8LNcQ0kgHdpLe+23MsAfmtMnl+sV6WO4/OIx3W1yaYkh58U9/3pGGCEQrEbd6X6ZmosdGfy5Wm+QkUKjnhlRjPLm/hZg7NCGEc9Ly6xG+5VXvdkK6P5btHZpDG9Pz+ezMu+BiTW6V40BBdzCZF2fldXI="
  # Docker
    - secure: "xxUmhWPB0MLv7DrKeLrt7Q5eNOjSFOL1phnaLLdmvipKBz12eCzgRiAhCmXWroMe4diIaodvcgKgc32kMwiNXaAVGuSOdTs04vRPB5YyGJSQn0BcFuVfBHH+ZPdtLDHzMB/toC1Nk/vF9cUGPvBPA1wDlxbFuEP7ARFUzdfhANIttNB2PVpWOAEWRBFceCpmcKzonhyRKCHZUO1rn64hzTMHJJbPKrpeDDrlJKwIlCSL3JzmuLxZ7cAGoLwQ2irAat6ZX+o+E4L042/+/AFmmlW9AouGHhEACqL9HhzZ1Z7p7SDYV3c6yXQ75j/HpW5RtaJWywEO1aX7Kk0q9mcWjH/X+rlPhtIaUmxFhQyrw9wW6KphQSxIDUYD6bivEWtdwGxPSYQWeO0GczXDv8/dw+mtz8i0/MfsGzUXadmy8F/zvhxSMx5WwaKvleBzLpbuKxXO4BCxcpgXofECByqTdi00NogwEaQOgm+0YU90cl0bvDEqqGP/kDqsR0Q0ZPBiK3+ckrnJrqMnPYCo3eBDKaVVT6PWDSACfVo0xdTxmS0KJWVnAXsYBz8hOr8v0nkiTD3GL/fUZe1wNQO+3T1oRPeYB+Lj7A/WzMcGCBomcyzeW3a4oxCaiRAA4MMS5QFIX9K5NWvSage9NzCJux2dFDU9UgPj8Dylby94Fu4wlBY="
    - secure: "J61/KUCNGuWiZ6kiZDMjcKWFXGfnluE2+umVV8zgKX0MmGMv5ZyB1QIBNgQi72UUZSrvCUFh+lf77t7SgdHVM2hrsAITgFraFIl3Cyd3nfSoyoI2g7clhtar3rOovyg+hmScVDy96xeIgbT+DOzdEqKw5AEanQO9wZxI+X6jUcqOJsj8dTVPJwaNOfQ/416qQxGQXKQMyBRn9N6e/Im0UmpfifqYLvnWK5+ELhxuFNs7ZZd/nzQRgA97u9ytDzHC1SIIK2LPLgn64IaiBdau8jWqD2PiveYlKzLEAu7aiDkLF7KUcOkh8Q3UUbf0sJt3IO0TJRUe0hdvcbpHpgHHQlTdKUuTVijpN9spdWobuLIp1QUug+zv1vlFUvypt1wR80wmiv9xFPYHrOvV7hTksNReo6yDeIE2H/YSLQSSKJaWfvT9vXDxMj4aNb3UVWp0FTdmd4d0xFG94pxYImXI/ZyzFqPES33MDDSC8ffIJfyX9MmNsEl3e6PaeWrgulp4Nkhene25R+kLrosqw+cTPoc92Hctm6zndrbUVeiywBPbRjXiEWakJ2MDzAqzd4GP/1tuxIL1YY8MOpKw4SNV19Ke1ywy59iRAb8GY4nj66aQOgErOdkGla8s69KJrr221rh4PusisYDRrirMev4MS0b68snxNjcN0FEk+IBvlL4="
  # Azure
    # azure_hook
    #- secure: "cqqZFqiKK3hFRxkubTGCC/wEeZ/jKykh7rYMH63/KTZjX2ZLQAeHxBgq20p+OaeYIs4oK8LalTIeJLXmVZ1TQ0cFrRtrglA0NCrXmwCfgWoOyodIEQEgo8vh+YI5zNHIkiZyKwL5k+KG/ASE65O0ELs5saSooXDrAkRlzrFy/UAPEYCzTPf35bYE0bTGZPZfJeFX319B3VVCL9vWao4InVkDxSaFhEaqC4Fcd8k69kT46wNrc6RP72LUax4nBoromRZXcUvglOZWlBqLAqqGIER1mnDk30rMRyTFF54d8fH8sU34sTJwZoh350MrOWr5acha9HP9knIcKDEJd0HDh61T3/f4N/5Lj799SJYOaYvA+Tz1Y1Eo+4zSIqB0WgT0Yy4yoxkoklNnrBxpqK/M7uyxHw//ddSKfCOu00ERsh3ZiQkUfhIPv+0detzT0skoKbjPzPSt3ZZMF0dKNcaMkEk3Rly92cJz7S/oK0OckctBghUJMnw5OzQv9mp9K1t/x+prR1XwHd18OZnm45z6oge6GqqsD9tnGNVVVjzerC86nCEhptVRMINTsbMuIfiPwZrcneU1om4894YefevXFJV53s/pirZWpXxqWM4XezQ/CByZ3ZYquWCUYW/QkxfJ/8av7G+/ybGAfcHnu6fsmUxP0yJ5FTtnHge8Rps+ov0="

services:
  - docker

before_script:
  - docker login --username $docker_login --password $docker_password

script:

  # Docker TEST Build the Image
  - docker build --target test --tag todoapp:test .

  # Docker Run Unit Test
  - echo "Running Unit Tests"
  - docker run todoapp:test test_view_model.py

  # Docker Run Integration tests 
  - echo "Running Integration Tests"
  #- docker run todoapp:test test_todoapp.py

  # Docker Run E2E 
  - echo "Running E2E Tests"
  - docker run -e MONGO_CONN="$MONGO_CONN" todoapp:test test_mongo.py

  # Docker PRODUCTION Build and Push 
  - echo "Build Docker image and push to Docker Hub"
  - docker build --target production --tag $docker_login/todoapp:latest .
  - docker push $docker_login/todoapp:latest

  - echo "Trigger docker image pull on Azure"
#  - curl -dH -X POST "$AZUREHOOK" -H -d

# Trigger Azure Deploy
deploy:
  provider: script
  script: curl -dH -X POST $AZUREHOOK
  on:
      all_branches: true


# notifications:
#   webhooks:
#     urls:
#       - $azure_hook
