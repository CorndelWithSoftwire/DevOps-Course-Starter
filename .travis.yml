language: python
services:
- docker
env:
  global:
  - HEROKU_APP=corndel-trello
  - secure: vckr+d1++qsPc9cjdK2SPJOLuWQptgWPFx5dgRviMv2ggDVgL9fnJly8nnkh5n3Z+3rXt1EWAiL4ZcCpdQJuy79GoXvJo8m9NIrDd/JYC75bIuOlVtSoC558zQUcI19d/hs/h8e/x/V7ir81Is14GRC3FLhFCjOyktus13fIpikC6jKODEcS3atd+hGGFolF03dnGDGF0C3LvBdP1pyb4+9yzH8551ErO48elyt33elL19WhiouyYz0sbdF5nsE0fvN57/jqbr/RSvaYyJ0yjXzVo8Hb63iSh7OstCAWDLzhABzRYGZH4EqF61JdPtdGai/3xo0SHCF8htfyiCw1UJXjgL00xYsFd1apxZ7LL6YbbzvP9ilsvzt7Q0G4WYOTS9yonM1emI82SZT6iS46rhOKoF/cqn3/sNXJ/UoMUr0psepgsuylE3fmDwC8NDxFqyWbtK503oMGwtbZ5jgjlIJFD9dI+fkhlEezfN1S82/UVVI31N5iwOck5AoNoE4Z6MLLlaCE8qzVggDPaBuKrlTbqETAMRd/t9piuXk0TSj3P5TwroAD50atxwbTzDahiNmYPfPeRhCfwkrNZjGW6cZ1tlvf2/cd2dh+M5y3eqS3tYdBf5TgQIx3AChUvXtGg9nUqj//4OHYhsUKe5r1Q8X5yuyt9PHjXvj8Ty106wE=
  - secure: KuO36ClFvODlzt0bjMARh6mwY5qwqvFZ8DBRDzHHoNMLOKZLnbXZXIgsyHAmuP/JX5O7jbZxpn0CcyuXjPSfRJTFiIRqIyPIYP7Bk76amQrn0bOnzLWADLcHTk4e8NDs8Bw4Zqc2EjqOmuO3Dem7R1NmaHjo8DnCHRPFqMzgKGNwKDFPEcIT85OuNK1a8vZODbM/3JWiaSaIdlXDo0lHeb5Upnl/y8RlTCxywyCSRb0FZ+8AtrEPSA+Y2oh7vp3kUoi7s6wBAezxPSYdMV2Dr0hCev4EVWgW+Q31ZKhCXMvYdkNRJm3i9YB+8pC7UoXZZCwlvW35qR+hDMMgp1oYlxCdALYh4Hw01nyi55ZgvNo92RbO+LByu0fBNS9A3gK0J2ZK0lLFndmKQtwCkWtcwYuMmXPCm7Zc9gH45bMqg2gK6K6jLfrNIFad79j+0wQgfZ2LQHs8jCW+pw8VkeByqjmPaR2XSWzFv+oAQpZcaFsQiXYvSdZH7PSEF4Z5BDT+Pk/Olv1/Sn43AHdEFsudPTVDdWNltY2BCiMmjVcEwxJVqrbzWCXNzJvnijs0mhWOskck+n0puE1eobqXBaHEYloH9irnaDq443Cvg72utA7aGq8ARXchhh4ILE5IXdaa1MP8Wl0SXV6T6yyWQ7dPby25skaywjaq/qO7TnlOjrU=
  - secure: BF6IfDFqOBmUbyNf1OZqNBEAjG4hTpN16YAKKHN4HK8sVcsGcAc0IQ/Tc2+AtN8V8d3dpMC7pzY8MzURKXn+5cvEcgmbBeqaNxhxXv2qJZD1r3UyCBGwUQlPkpMCQwliZwuHM3XYB4/6/9nP/PwIBptsCwMajGyATudcKp1abNK+hB0d+2PSQzvRpu1QBktRb4Od+VYqPPvwKn4z4gx4mKh+s9aD4KKMjX6V5Vbi9NOEL+wYvPAr2QxgxAm58t8+Aw3IFPHx+5GEiAFVG7cTQGpY/krQopa57uOEfQjt1kK6ncIAP+d7OXRiWHB/DNAj22LsGE8zJ+DwdWLZKJoIZ6DvN3fJcUIOXwZARDrjeAgL0ZXqentLmtmISg1uiysYlhvcIZ935TJ632CO9rsTYRjGga+g4GwBMZjKplpAoqCHipzIRl9N289UEj+QwE45YavmlvFy0hgEoRVf5yeXyFX76kJslDuXtuWQcgGHqGIBVMbqMMw+rEX12iKLEluOnqmKcuQ0M7DntD8Vk/8A2vpXkvRSQusnQxq+5qsXiPUBNrkl0w4wJvO13G5eisDhBX4rLMGjP98cad+SfaXM/nY2IwkNcPnfDKbxOvlqpO1OsMf1FcLZSLQ+o9rVL/t5q7uMXtqd1L1tMiKkcASDNOtmAEVzHmEVLU0pAJbRhjU=
  - secure: DLn1U5GfXWc2GzkIDFzbYripgnJGasZt8v2cWkIG20x/hl4O8ukwi4EMmjRhtnbGzixhSz8ponxkt276cZnXqru48yMm+NQ6MwHs1kLeLon2kchlmnZeppfRD6T0fcOgpnimTlfxqlm+2vvCXLkosjP5BM89D81VfU9kUpToe5HIrOuX4fyfmIUt7sJAFd90UpSuXTYeHabjLFx3rfVHh3Q8mbol2d2QlEbIfpUoI46/GGGANYhpoDSWMWPFCcZST/ApeeNtiZk+RvuaoGjQoFkcsC0wvnU/l5ySdtGEHMqjd4puahDXGmyPT0MUtzpdOsT7h0+Lq7aI+hVxc/c92NPerF6ugQpKTUhL1WK1Ei/yYfdb4aP5ru64MqLobs549FheAKbeGnhiQlYvB9h+9Dum6mxhUgqxJoPUea8rxOPUMutUGbLq3X9xMaw78LSSZm8BbMFUL1TaGd56txNF70v/fvrgolnVkvbek5yWGrrTSqwUI+jtMH8X0+9EVctvtUbuNORREQQSyS3qrSYuULZBlZKChFaCObpuffjmzgjEv9TyoATnLRW6TCicQnpsLM77eO2H6M99iue+NTACTQKBAnh39dq+XN0uB3IMGrL2Atfo9GW2mSb/q5WUGhiGcY2su77UwbdSoflq11314KzNqd5Nc08+lj3/8M6QsSw=
  - secure: tzMJDFpqOq7xeUmYzLUHkvgYzXCJvnPbtl8GKkPfKDOD5FLwfLPYkJZ6ElPPei2IFxAoKmBQEwBWxb64KmYC9RwLANovF7JW6B40B/yi0wQrz9u0Mzx5JG9lVoD6EZggaJtzvRV6Gm692BzDaxRMpEUhcm1tCCY1RmTHAX+VvlNbK+pljowJPPLdXQAiFW1Sy4WI0J8CuCQSnp2x8XRXd2MVAHbX3CKB1B31OV3nTsLxp12WRJDLxHYM3lUddDMh+PlfCtAodMY+gaO2mVsFWEDD3bhTVmgpfh4d2m7lLyeExyTfrRrd/1k4OKP2welKlXlZ0vPU5BJJgyz2OD5Rsgf3f1BaJ0a/YtHbMnV5sJGi59OBkyA406a/lE8ZJ0kuD+/ofe8mH02T6Zcv+M6fZLY85+MDyzch4jDpbEGmiOPSHTddDBv/ImUeNeYacgagg3WOfCktl1QzRvt22H90AHgnndVIsFCZNxlQgipCYpeteBIZxPuvMZVxhnrQ9TxTVP4pgT/RS09xZrmkTsnyDAkgeuJQMCvBS0fSqRC13WGQjiEPN7IWgX5RaZ2neO/HeYZhfoelF/Xbm7qj1hljlcyFuuGDmasfEtmykHZ5Zl+zylu6QfgGvTwUWeil9uQctHG5+tWnHJYpBJPuslWFD1uUMIUp8VDpYZcTqpzBw2w=
  - secure: C8AcBf9SipGXU0icpLm3qaMBhPMigSIqeJG/HEtcLAUF0dvJdD8sRXRW8riadTgurYYouIu8WCe1tLtiMwOsPzCEJx8Li4ph1y6uQRYCsjPg1p/KBU+seYJ5g+RvHbfYtVidS8F6724LFe++T+u1Z0fBlSYfYAGBpgUqLKM+toUs2qDvMZ37S4CADaHwyA3mXBWG25IA0P5P0Y1zckO/K3oj8ZMdIrIQfEK0kc6kZUoobUMaYNWzfTthBZ9+RP+qVfX/KAPaJQR+ZZc5EIGcCJKd2upCd+tkNn0cDtJb+SI8NWtK89CpLGqNeCVLWW8ZjXTU8bpR68zKnW0sUMcHT1FtpsmpDVAxtf3B53XIKo2ViEzTevOH6hPwHe2kkYTLd7GZNtLaROwv9RqHKnxpdJQ9erUyj0yfGDkYuFkNN6YocP9bmgwa0+64LlrPB80rLYzO/utglMbzCjDK3zsv+3pxgNa3PKwksS3t1N/o1eXfrADGeVF/OaYlMBJIV2CBDmXWFQtcXkVVU0Wyx6NB3pSnnat4h0mT+q/UugrNKiW9IuAQHnkaPZWzikSNaACMG+pEjR0azlFhgIWK5Hp7qpZUZb+A6A4X/3QLnngfhF9jKJxVpGU+/OXhaUy9YdHrwl3Rp1rsTUcDCvs+Gx5UChg8t0Ge3sqRAuaqxjYBY5w=
notifications:
  slack:
    secure: xsQM9c0gQYB4HK9ugFF5jdE/1sHcAytF7bB9sVtC4jrDBxLaHFtQYrdijzbf3yn9kKUbcOtESov1ary4e9NcF3751tbt0hD6b6QT2Dbx6ZcWrKB6MuCY/ady/T4KvwVlPOwsBk5QXyG2anRxaV1nqPu4/eUPVHe+RBNDkNzU88WcYx8BsUCsWIG4u9uWs8WJj4KVbgGNMoi8AflpB/YeQOYY0TOmVP84/QM4w8EwssE8fHGpNsq+Ad1iGyKLF1HSon9dAIT4QEx4DnJ6N8hT+oGWjIGaiS6MsZHH6w0mL2D0mBxTHaoDoOqjaZ+rDsbSDhM6c+WpLTde1nK0sbcgbvWDGD+g5fYmX43QNv75++7CkO0+GTuNCKF9vnW/P4eaqNjPvpR4vBbGjWw8cQsPjhinLf6ZRRdURYGEAmKfX3c2SNprEi5bto4kI4rmWbrR1cs3ny7esz/lKg6RsqWrTvDHeVsmIIXDSH+gHFtHK0pjlvrgLKwZUNMwKUh21wGY/xgXVNk4r++18S3FyitWBkEP2HRf8eWGDgqWCXSDqMOj1OKeyXAEUiXeSB7m/qPIrVEqqXNc6IRoxETBlWZg4xf5ZZJMCPJu65e4D7GL9TMGNmhTC6Er8xAZB4NN/mhikFC5mNGhxaMOJ4FnCcy2tn/nZWrcL4Gqb9zyNcEk1ys=
  email:
  - wijimec635@poetred.com
script:
  - echo "Build unit tests"
  - docker build --target unittests --tag todo-app:unittests .
  - docker run todo-app:unittests
  - echo "integration tests"
  - docker build --target integrationtests --tag todo-app:integrationtests .
  - docker run --env-file ./.env.test todo-app:integrationtests
  - echo "endtoend tests"
  - docker build --target endtoendtests --tag todo-app:endtoendtests .
  - docker run -e DB_URL=$DB_URL todo-app:endtoendtests
after_success:
  - echo "Build Production Image"
  - echo $DOCKER_PASS | docker login -u $DOCKER_USER --password-stdin
  - docker build --target production --tag $DOCKER_USER/todo-app:production .
  - docker push $DOCKER_USER/todo-app:production
deploy:
  provider: script
  script:
    echo "Deploy to Heroku";
    docker tag $DOCKER_USER/todo-app:production registry.heroku.com/$HEROKU_APP/web;
    echo $HEROKU_API_KEY | docker login --username=$HEROKU_LOGIN --password-stdin registry.heroku.com;
    docker push registry.heroku.com/$HEROKU_APP/web;
    heroku container:release web --app $HEROKU_APP;
  on:
    branch: module_9
