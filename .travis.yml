services:
- docker
script:
- docker pull kevineatondevops/todo-app:latest
- docker build --target travistest --tag todo-app:travis --cache-from kevineatondevops/todo-app:latest
  .
- docker run --env MONGO_USER --env MONGO_PASS --env MONGO_URL --env MONGO_NAME --env MONGO_DB todo-app:travis tests
- docker run --env MONGO_USER --env MONGO_PASS --env MONGO_URL --env MONGO_NAME --env MONGO_DB --env SECRET_KEY todo-app:travis tests_e2e
deploy:
  provider: script
  script: bash todo_app/deploy.sh
  on:
    branch: master
env:
  global:
  - SECRET_KEY=secret-key
  - FLASK_APP=app
  - FLASK_ENV=development
  - DOCKER_USER=kevineatondevops
  - MONGO_URL=cluster0.o01ag.mongodb.net
  - MONGO_NAME=testdb
  - secure: PyhJN6ZNtSH06PfTvwfvNZtvLaJL8j6Y+fXOH+kn+AJG3k6xrf4zpOh7CNpkm2QrrRaT4TU+1Gcym0US6ZJ0khOet5ebWDs1jic8oypKTO7kR60cs9s0ZMDJMKMJ6T6QTMncgQaxfmjlZSYL3tvPsvnT/16JRWfGKXxbNHXXsSPZrdOhUOQeadCZcZGpb6AdR5ZaV0DcHfc4/wie6j0NOT1+MzRDemS7dMNmgi0pXaaOXVd9R8S5Cx3JX6K+JndiquDBG0wWlgqr1PwSoyXjaAQegnlssE37fbBGLctTg6uFgh14KxaS+9ie4g0fr1978akK/FTXEu0Sd7BOm67EUfCJa5CzPRMVSwn34ydhhIyLPyyJMndg+ML22IFZYia57IkkToRQpmSrtqGOnNQF50/7I8PLIeQVd7DMoNfdaSNT0vyR61DnqMyW5unXfosq1k7jI4H/GG1BhjsC5p18fxgtO5SVRHoJKG09WYcI6Kr/Lt4eMo8nlvA1btLn2q7djqcu3pdb2tPzzvaMpok+alKiqGIT6AePm8ZT3vSxjiA4I6U7r+3G9DucmL3jiSfSaNl6VRKRc9p0swTuBl/N8luuRlhjRJPRxd7YV6zUn1RVAFrub3KzPcOfqBrxbSKfEf3FFzMwO7b7UM9qXmA3rZKaPAY2x9iAz/ngvXYP1Ns=
  - secure: bPeA2bTZl7gfpAK1qJJlNnfZa4Gy8RRbbxrMzBa06TzmwR6FwgkMPs2s9r9YECdS26ffrQhqw8WeGuInnv6dHiL8He4erkwIY5cMY5zLHTFvXfvkaG83k2orKOBIEwrWLBK/NWAAd87zCBGEQIv3ouQ8TyCwrvt/rKZ9WSgyGn/RnTbXNon3AVCyz25i6XIZORBUQXtd1A7GhPmPXu0yPb/7fhMUa88juoRf5kFow3EFN/kySaXATaGhye2f3047MIaWzDQUTY4TPaHkqQ7EAFhs7ixmIi9WAVf5+wTHD3ib+voMZNKEqGTPRPLkjuC9lFuHi4QXPL5xi8ZWu64jHOM2XwjSu5u8AkGDT/7xI0T4tW2UV3NoJfxjyfb5GV+fwa3vkghilrGzxFArd+zo+bctiIg/tyVPpgoV5qoQmpE4UDpHY2Iwy3cDXA2oF3WseOr0E+iuYI6h81xPI97RBjD2VcAaNw+Wsbj2uRv1zWQt9gtWIzhHqS9mSEUGZJsv0M8Oiw+byrT/TvWPNcT6Q/DD6q1+em2R5gk/HdyZp/sIq/iYNmyW26+AAacZBUDwM9ttQ1r3sgaA1Q6I4azrTO7Hy3QK1A/udKeL3OlPF0cxUdPGCkMl2sIAucKjTBttwb68sEOqjrDa3ZYWp6KWn0qdIZ3GeKVFj6ITi6mi5gw=
  - secure: S7TpdIDnNSXKcMxbh3f0DdEgkat/mRPn88qo3ecz1TbXlv12dNAoSyzsfZjHWyaUwTXSQT+kT+UYvCyJcEvFyuYukOGoQsPrSA8AHxPhqe3c7Wt6ybGeUvMTK0HlccIsikbbd6ygEN3S50efLrr6CwyJkzyEAj3X1wSrd27hRY+5Ul2JXyawhWgQlBZS0r2QFkMMRbvzDfDWjDNX4VMF+5aVszMZEnl/S0JR5mA3lzaQiNeCIyu10dVFRm72Cq+0W2lbQeBl5FppfGIWGivCFwwg4aZwSWF6CvcfucmI9WgJRRoFIA5SVol3SO6jt7davrVdaN0LxgaxfKEpv6vvjWTW9cEm4PaHm+BmYqvdY8TQWSwtOEs8E6njJhZSkKa0RGTLEt2Dn45bsj2tLsxEGQD1S1m7Xj2VoG1uVYMqEj+4PWRZ6YzB+vbK45SUo9AMK7Bn9W8idwxX9KlnoKfEmbAqz+VMMp4Oe+/OQStAwYXr92+ZFGq8NtRjB8zU0sJZTN30z0jenTXAxWk4K0qtir5rHya/9TQIPywJHeHYJuqfB5vKqv5jrmvzktnl5m4U4yG60M0tthv+Og9o4mIHtWbBkW4bMwpfO58TUaih2cgoTWu612GT4ijx+hxhURAc/ED9seWfclJldlAxODCXUZ2md2EjgaFI9M2k86FOa1E=
  - secure: UHCDz16dKEMI1YeYuEXDa97YtIEbxf/zrKw52qRIbdLbU+xX6TDbJ0MXx4sND1QLHJGKAcqdculwQrtAEcP+chui750Q9Se9pR1H60vY0pY/u1aSFnpqR+FQO4Yv5oI4srUM7ThdTY5OB7iaMHfzqfQqyxulo6h1ptjwq9w2Fqk427+2+s43XUdKBmjo9nvfBxCPxJH+kflrcpRTrsIqz8EcAghYxXmyhLI1fiHuGGD6dxzxkm8DwgVH0His+D0k/E10+nvj7f3Uh37hTvrqYZnPW/bTZB15nfk7NZXZk8jGhQEvoUgGbExGVNoogurZSCMuIwpo7tPfElYR2qJlqX/bBMe62TXyk9AjOv+gvW+yZWmDgHY9KsEMLt4BtErIDtnQXJQ924SsjQ/ffgNFEctLMTb/l4+3KN8s0Ul8alMLFfaWvwGyBUM24bsfZ+zWI1m8ibFvHzjs4pbBztS38bH7de161Q8UX5udZ4F6FQ8SA/HhjPxxB6V224bGKizDU7Py8JovMI6sUVeYJFkJ6ImODQAFBFK7BEgSGHHIbvuGbCY/1yB8EDsAy/DogSRvxJlP2CtauzDTPCny0eAuxvNhFLbQeGApC6LTqHp+500qHSCIwVPPjojPUWYfRc+RQ7TjOvUgC2jRyrraWvw2HXcJhClS1AS6OhsnTXFUNT8=
  - secure: KsMop4B6Vf0pAAEQSvio8+PWhE1/SMMbSdd7hmgWEPxJ5vs8U635VLRmz/sG2DY3LpOPmj5BUBFmm+1mhkYCtZoVNbMnkbD7Iw3oN3/vSZsiyd85HPEQmL/Dgx54v8mE7otglxlQ7rzGYOr1dbGK7Aq3qdM/bj9eGQyXJBFxybxfKzC75y/iwdODRkg9DAcLC6XUeWKZZp/hFN9qBopunuyEjfANgy0oEiwWPopXJSOQxxn9/qC5hrrxQFliPzzOdc7O0UDBhrPUbMZoFcUG/PWGxgePFupTC0WoPxTUvwJosruJYIJ6uGa+5BNjnC/Nc+xI17vTdGJVRmwgSR39BHhmwn56DL8WuzrxknHC3kaEpA5bGnJFTzF6d9ujSptP7mtum6Z9JEDqDj/Kyl/ojCLeRARgMr6ucv4A1Vrewyog7Aw/bmgVOL2OSEixaN9Dzibk2KzVjDEDsPxg1OQ8HHXLFxfDLEGszk4LurxwWtNrXekSS72XO47ZHa0Xxe4jRTzvTnSahqIKS7ZSbH2LQPaROr5yyoIfU/XfgjN8DZFZstM6bQrFP3YgdPl/Eskf2Geh1J52glbnfkRZghrrJQREOk5ATRAXKB4Fk4l7VNf18WA07+rfuFdVkxCk73QlXT38/P7dudh3401vw/JTGzfBj87nQgFTTV7E/Kelj0g=
notifications:
  slack:
    secure: VY5FnTJoDaCRx46cR2pvQqM5mqBzoR4iVSRblNqt2dYx8HwMGdWJjb5SPTQfToCdY3WWn0bqVFAuXNz+GsOha2XILNZXgqejo0GexRwA+yPkon8cCH/8h/sPWUWu/qeO4/bO00IC5nYkmpKmVlSg+9CcRybopF/RGgRNapTa484uAUlRrTfRWhVwCe7RgNTMf1wGbRmOOeKxoTTKOfW2tpX4xgt2dNC+8Wr9cYbfuH+4yBHghXSB327JRTTH7K5VEOh+SVJRj5L6lQ4SplZrb/1EXUAMgip+iOnjnDQiRum93ChmLEo0OUaLrl1V3RsocjF6FXZBPBNAuWvUbNywcAI/tOAQt5BASRXHJ1HreZRt6q0B5BJAUThS7ESQ3DxDClRgQzkwPwopsCurxhxHnV0EwSMKUXuaRyJc7nhHHuiYBeF5qjJ7p2f19nr7bta/D7YrAU/uEI+vDMx205U85PBsPAvtQZcW0gz65L1GAb0slalSlMftGJTxcUQTN2eoLclWtn0R1neoi/xve96k4E30pxBizUwlkk/dGlM3xVhHAG6NRkrjy2F97fo9bHB/K+lYDNBL/BfHqAvMv131VaKq4xgPGZTuFMqG1cZ2NsLwCIowtUY73FB2CQgrjf4enVL0X3tLTQtDfknHnzP5SPIkW/SagWIB2v1vko4C1MA=
  email:
    recipients:
    - kevin.eaton@capita.com
    on_success: never
    on_failure: always
