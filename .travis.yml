services:
- docker
script:
- docker pull kevineatondevops/todo-app:latest
- docker build --target travistest --tag todo-app:travis --cache-from kevineatondevops/todo-app:latest .
- docker run --env MONGO_CONNECTION --env MONGO_DB todo-app:travis tests
- docker run --env MONGO_CONNECTION --env MONGO_DB --env SECRET_KEY todo-app:travis tests_e2e
deploy:
  provider: script
  script: bash todo_app/deploy.sh
  on:
    branch: master
env:
  global:
  - SECRET_KEY=secret-key
  - FLASK_APP=app
  - FLASK_ENV=development
  - DOCKER_USER=kevineatondevops
  - secure: PyhJN6ZNtSH06PfTvwfvNZtvLaJL8j6Y+fXOH+kn+AJG3k6xrf4zpOh7CNpkm2QrrRaT4TU+1Gcym0US6ZJ0khOet5ebWDs1jic8oypKTO7kR60cs9s0ZMDJMKMJ6T6QTMncgQaxfmjlZSYL3tvPsvnT/16JRWfGKXxbNHXXsSPZrdOhUOQeadCZcZGpb6AdR5ZaV0DcHfc4/wie6j0NOT1+MzRDemS7dMNmgi0pXaaOXVd9R8S5Cx3JX6K+JndiquDBG0wWlgqr1PwSoyXjaAQegnlssE37fbBGLctTg6uFgh14KxaS+9ie4g0fr1978akK/FTXEu0Sd7BOm67EUfCJa5CzPRMVSwn34ydhhIyLPyyJMndg+ML22IFZYia57IkkToRQpmSrtqGOnNQF50/7I8PLIeQVd7DMoNfdaSNT0vyR61DnqMyW5unXfosq1k7jI4H/GG1BhjsC5p18fxgtO5SVRHoJKG09WYcI6Kr/Lt4eMo8nlvA1btLn2q7djqcu3pdb2tPzzvaMpok+alKiqGIT6AePm8ZT3vSxjiA4I6U7r+3G9DucmL3jiSfSaNl6VRKRc9p0swTuBl/N8luuRlhjRJPRxd7YV6zUn1RVAFrub3KzPcOfqBrxbSKfEf3FFzMwO7b7UM9qXmA3rZKaPAY2x9iAz/ngvXYP1Ns=
  - secure: bPeA2bTZl7gfpAK1qJJlNnfZa4Gy8RRbbxrMzBa06TzmwR6FwgkMPs2s9r9YECdS26ffrQhqw8WeGuInnv6dHiL8He4erkwIY5cMY5zLHTFvXfvkaG83k2orKOBIEwrWLBK/NWAAd87zCBGEQIv3ouQ8TyCwrvt/rKZ9WSgyGn/RnTbXNon3AVCyz25i6XIZORBUQXtd1A7GhPmPXu0yPb/7fhMUa88juoRf5kFow3EFN/kySaXATaGhye2f3047MIaWzDQUTY4TPaHkqQ7EAFhs7ixmIi9WAVf5+wTHD3ib+voMZNKEqGTPRPLkjuC9lFuHi4QXPL5xi8ZWu64jHOM2XwjSu5u8AkGDT/7xI0T4tW2UV3NoJfxjyfb5GV+fwa3vkghilrGzxFArd+zo+bctiIg/tyVPpgoV5qoQmpE4UDpHY2Iwy3cDXA2oF3WseOr0E+iuYI6h81xPI97RBjD2VcAaNw+Wsbj2uRv1zWQt9gtWIzhHqS9mSEUGZJsv0M8Oiw+byrT/TvWPNcT6Q/DD6q1+em2R5gk/HdyZp/sIq/iYNmyW26+AAacZBUDwM9ttQ1r3sgaA1Q6I4azrTO7Hy3QK1A/udKeL3OlPF0cxUdPGCkMl2sIAucKjTBttwb68sEOqjrDa3ZYWp6KWn0qdIZ3GeKVFj6ITi6mi5gw=
  - secure: KsMop4B6Vf0pAAEQSvio8+PWhE1/SMMbSdd7hmgWEPxJ5vs8U635VLRmz/sG2DY3LpOPmj5BUBFmm+1mhkYCtZoVNbMnkbD7Iw3oN3/vSZsiyd85HPEQmL/Dgx54v8mE7otglxlQ7rzGYOr1dbGK7Aq3qdM/bj9eGQyXJBFxybxfKzC75y/iwdODRkg9DAcLC6XUeWKZZp/hFN9qBopunuyEjfANgy0oEiwWPopXJSOQxxn9/qC5hrrxQFliPzzOdc7O0UDBhrPUbMZoFcUG/PWGxgePFupTC0WoPxTUvwJosruJYIJ6uGa+5BNjnC/Nc+xI17vTdGJVRmwgSR39BHhmwn56DL8WuzrxknHC3kaEpA5bGnJFTzF6d9ujSptP7mtum6Z9JEDqDj/Kyl/ojCLeRARgMr6ucv4A1Vrewyog7Aw/bmgVOL2OSEixaN9Dzibk2KzVjDEDsPxg1OQ8HHXLFxfDLEGszk4LurxwWtNrXekSS72XO47ZHa0Xxe4jRTzvTnSahqIKS7ZSbH2LQPaROr5yyoIfU/XfgjN8DZFZstM6bQrFP3YgdPl/Eskf2Geh1J52glbnfkRZghrrJQREOk5ATRAXKB4Fk4l7VNf18WA07+rfuFdVkxCk73QlXT38/P7dudh3401vw/JTGzfBj87nQgFTTV7E/Kelj0g=
  - secure: PN6sX3tQ1h8mt9t/JG+m4aGVTMaHOUtczrFLfEY7sQWwkMAkKGlk3v3dJ/EdpUxIwSixdnk/zHkn9Si1z3FSPsHlvp+g2HgmA85JX5NEEqLs1CcFXvzRM/Y2l9x5zLHpRmIZoCw1865dxzJd3mpjRRyGpHhx0Fm7yg8r0EXKJ03pPNvEiyCl1W/fXwx8/BiTFlOwvAKkLekY0S4/GMqOManJGe8cnzF2KvkN9PfEdx8pS7wPO+yy5/tpxij/mba+lFdFESfaG1xoSoyvaal16OpOOvFSNcV78A98f+ZPNKQ1CDw6qBbxrku5rNjicrTZQC22djOIOYCZpjd41bb5I8Zpc3jpd20aHNr4ou0z3l05Glnz706wtTyBB3htctyS1pugX5hvUOwcBIvJs4XemQR/5OI9OArTg3FOlJXtbomhgFW7X3MVqlVie42T4VjyimG6WcdyYduQiH/YP5JmHO850Jl1RoU2fHf8EoCPsB41pvstxQqg3S9zbxCAdu70N0rcS3uXxmirJvMJuwgfTrZ8rAtXh8PGVVSwu1hHymzukJMk8EtEnu4DC/fymA/aDMoFKO6DhvhltPzOP9/d3+5x9yT2hO9WE1btOG8c2eB7ZhdgDfqVeQnPwB5s6Ro1b1kgPIr+nMHHLCNmW4NNOLrs+oXqMS0zkawRCekwuao=
notifications:
  slack:
    secure: VY5FnTJoDaCRx46cR2pvQqM5mqBzoR4iVSRblNqt2dYx8HwMGdWJjb5SPTQfToCdY3WWn0bqVFAuXNz+GsOha2XILNZXgqejo0GexRwA+yPkon8cCH/8h/sPWUWu/qeO4/bO00IC5nYkmpKmVlSg+9CcRybopF/RGgRNapTa484uAUlRrTfRWhVwCe7RgNTMf1wGbRmOOeKxoTTKOfW2tpX4xgt2dNC+8Wr9cYbfuH+4yBHghXSB327JRTTH7K5VEOh+SVJRj5L6lQ4SplZrb/1EXUAMgip+iOnjnDQiRum93ChmLEo0OUaLrl1V3RsocjF6FXZBPBNAuWvUbNywcAI/tOAQt5BASRXHJ1HreZRt6q0B5BJAUThS7ESQ3DxDClRgQzkwPwopsCurxhxHnV0EwSMKUXuaRyJc7nhHHuiYBeF5qjJ7p2f19nr7bta/D7YrAU/uEI+vDMx205U85PBsPAvtQZcW0gz65L1GAb0slalSlMftGJTxcUQTN2eoLclWtn0R1neoi/xve96k4E30pxBizUwlkk/dGlM3xVhHAG6NRkrjy2F97fo9bHB/K+lYDNBL/BfHqAvMv131VaKq4xgPGZTuFMqG1cZ2NsLwCIowtUY73FB2CQgrjf4enVL0X3tLTQtDfknHnzP5SPIkW/SagWIB2v1vko4C1MA=
  email:
    recipients:
    - kevin.eaton@capita.com
    on_success: never
    on_failure: always
