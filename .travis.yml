script:
- echo "This is Daves Mondo module 9 work"
- echo "---------------------------------"
- FLASK_APP=todo_app/app
- FLASK_ENV=development
- docker build --target test --tag todoapptest .
- docker run -p 5000:5000 todoapptest
- docker build --target production -f Dockerfile --tag $DOCKERHUB_USERNAME/todoapp .
- echo $dockerhub_password | docker login --username $DOCKERHUB_USERNAME --password-stdin
- echo "Now for the push"
- echo "-------------------"
- docker push $DOCKERHUB_USERNAME/todoapp

# module 8 Part 3:  Continous deployment

- docker pull britboy4321/todoapp      #  Ensure that we have latest version (possibly not required)
- docker tag britboy4321/todoapp registry.heroku.com/todoappbritboy/web  # Tag it ready for Heroku
- docker login --username=drawlinson48@gmail.com --password=$HEROKU_PASSWORD registry.heroku.com
- docker push registry.heroku.com/todoappbritboy/web   # put it onto Heroku

echo "CONTINUOUS DEPLOYMENT SETUP COMPLETED NOW"
echo "-----------------------------------------"
# ---
echo "TIME FOR ACTUAL DEPLOY and RELEASE NOW"
echo "--------------------------------------"

deploy:
  provider: script 
  script: 
    heroku container:release web --app todoappbritboy
  on: 
    branch:
      # - master
      # - module7       # To be removed eventually
      # - module8       # To be removed eventually
      - module9       # To be removed eventually