env:
  global:
  # Trello
    - secure: "Dh7ndyxgpTHDa3ilqSNPInRUNyWd4/PLQSlk9FYtcnUcMnLU4KD4hK4bJ+VMsXh8pvAi4TMgB3+rffud2Koo920Syu9evclTgiKAFbZpxQgK/R3zfV0OS7VN8edgnUaF3P9WTbUeRkPXxqGbjLAToFmMRTbIxPoX5VvRmMyQNpwxdwEmmfeWqQG1QL5GtiIKJlDXYJDDSxgPL18XFnWEblzX2C3vaqn2A7m95Z02sOS5FIVWgnr0SB7UN1wpeqg6QNXjKbNAdhQlBs0Nl3nmUBKZQvZWweGAWBhYylEQ0twjqkXAH5v52wvizbpNJpxOu/4G+ukl91wkK+7bF4m0EVbD2giSjzSyM08nDUJ5+EUFEs9ALWKHqetWeexqjIR9eJ97rT9+rp+wlIU6sQ9X9ZeyJuDpP3sF9sIB/talVdbLSyVwE7v2xTKSZgzMyG2OE7ZIEWgm9tO5NoLfCHDx9TD0Zb9G6tgRbOGIfVbN6QLRR6v15AjYP7Z3w0QykObaieqWU6j2xcqib2k0o5ePrKYvm7QvYcoUIPbSOW8w/ApQZ5o7OJBQ3u0tU6GIuKZPgDD+dCrf33BBPSbakoqS8AJsWFlAkpyygW5UY4ZF2ruicD1PX8HdIkLIOk+PGk19iuvMv+cN1qF08/q91FK82peh8kttXWL0lz5ePoCZj8Y="
    - secure: "SQa4hlf24DE77YhEaG/MA694g0+EEmaxzd7y6I1wdV7P8wkcOdWtSmwHTuklzkVljzE5a6jPeOC0pi8eedU90rPwfytEQlpmTODTgu2RgZJpTzHW9ePIKaH+2BPXFrwuFwnY12NWJIunXGZa8DDDDom8oS3UuJsyLq9UdDoETJPtq+31gpzJ55EtxVtGu/ROTD5rLDjQgABiASKgjITqgMn0dy27pVxv3Qn49dBEzwBvXiOqi5BSisI8mRKZBHWc4xSUWX6lIk5gvj6ou3S1SSKwL57EXuUIF6HJzjYgbaXow0pcDth9ExHCNyGZAmHEhoIlXYyvbGFA5BxDOyQKPK+6Z8dVC7vKzds+ETwnCyB4D92sWfAHYvFS7/EydKFBNdn2NYlKAYTTY/VtNgS7RzJoFMdziwi+H6o3gZHast8dmJmL9I9vijpMBBtADkfLs7/D5SsPiwZnBikvH+XxecgkaqD+IGf4RGFNQsVMd2DBacFlJB5DcXYWISKhXWYIthfwnbKx5f+luciu7OX2h/Pganw20TsJBotl0IW33w/lzu/pElhH/XVl5NDWSdbcv/0+uOU8yDEzfaeY0qlrFKD9a7adcUNAiAFSsNuHGUXQYcT5qfquSCD0hmxLJ7yqdDxyBi2IsPiRR28v3cTsyiKIIf+3E/6kOKQ7GhBfMRQ="
    - trello_boardid: J3hiTYRX
    - todo_list_id: 5efa545c830dc848ae0c7cd8
    - doing_list_id: 5efa545cf6f6961180a75b76
    - done_list_id: 5efa545c20355627365e68fd
  # Docker
    - secure: "xxUmhWPB0MLv7DrKeLrt7Q5eNOjSFOL1phnaLLdmvipKBz12eCzgRiAhCmXWroMe4diIaodvcgKgc32kMwiNXaAVGuSOdTs04vRPB5YyGJSQn0BcFuVfBHH+ZPdtLDHzMB/toC1Nk/vF9cUGPvBPA1wDlxbFuEP7ARFUzdfhANIttNB2PVpWOAEWRBFceCpmcKzonhyRKCHZUO1rn64hzTMHJJbPKrpeDDrlJKwIlCSL3JzmuLxZ7cAGoLwQ2irAat6ZX+o+E4L042/+/AFmmlW9AouGHhEACqL9HhzZ1Z7p7SDYV3c6yXQ75j/HpW5RtaJWywEO1aX7Kk0q9mcWjH/X+rlPhtIaUmxFhQyrw9wW6KphQSxIDUYD6bivEWtdwGxPSYQWeO0GczXDv8/dw+mtz8i0/MfsGzUXadmy8F/zvhxSMx5WwaKvleBzLpbuKxXO4BCxcpgXofECByqTdi00NogwEaQOgm+0YU90cl0bvDEqqGP/kDqsR0Q0ZPBiK3+ckrnJrqMnPYCo3eBDKaVVT6PWDSACfVo0xdTxmS0KJWVnAXsYBz8hOr8v0nkiTD3GL/fUZe1wNQO+3T1oRPeYB+Lj7A/WzMcGCBomcyzeW3a4oxCaiRAA4MMS5QFIX9K5NWvSage9NzCJux2dFDU9UgPj8Dylby94Fu4wlBY="
    - secure: "J61/KUCNGuWiZ6kiZDMjcKWFXGfnluE2+umVV8zgKX0MmGMv5ZyB1QIBNgQi72UUZSrvCUFh+lf77t7SgdHVM2hrsAITgFraFIl3Cyd3nfSoyoI2g7clhtar3rOovyg+hmScVDy96xeIgbT+DOzdEqKw5AEanQO9wZxI+X6jUcqOJsj8dTVPJwaNOfQ/416qQxGQXKQMyBRn9N6e/Im0UmpfifqYLvnWK5+ELhxuFNs7ZZd/nzQRgA97u9ytDzHC1SIIK2LPLgn64IaiBdau8jWqD2PiveYlKzLEAu7aiDkLF7KUcOkh8Q3UUbf0sJt3IO0TJRUe0hdvcbpHpgHHQlTdKUuTVijpN9spdWobuLIp1QUug+zv1vlFUvypt1wR80wmiv9xFPYHrOvV7hTksNReo6yDeIE2H/YSLQSSKJaWfvT9vXDxMj4aNb3UVWp0FTdmd4d0xFG94pxYImXI/ZyzFqPES33MDDSC8ffIJfyX9MmNsEl3e6PaeWrgulp4Nkhene25R+kLrosqw+cTPoc92Hctm6zndrbUVeiywBPbRjXiEWakJ2MDzAqzd4GP/1tuxIL1YY8MOpKw4SNV19Ke1ywy59iRAb8GY4nj66aQOgErOdkGla8s69KJrr221rh4PusisYDRrirMev4MS0b68snxNjcN0FEk+IBvlL4="
  # Heroku
    - herokuapp: rajrahmantodoapp
    - secure: "XqhzBHilcb6pvc+JpJRfsFDsRS0px5ymO7S4czUnODcdZDaOwp13uU5uUU1WWUIP5N9A9KJrnfp9QRERmGvNi1GULfDzSeNbhLynCSzfIBrHUnmaXMCIscqCZl7ApE0/wh5ALMp5vwoowULKHXv63ALGxoBmW0UD5nVBoXSISdVQnettrA0wxWci32+CmlGdMkM+B0y+QTCIp2kW6n89ZZdipmrURBi6Yw4H5wLaf8+3ZpwSCaj6rRDyyAdRf4GM69/yRvSetNlBJ3QgXm2ZP/w5QWyapaKk0uLYqAaaMu0l+8kk+dc/GHLnGQ/+QayXAZ6QDTWXr3SM/KbAVQv7k9eSdleRnv89ps2Flkw4yK3BzmXdsezD+peXiua5/q/cwK2/h5kJ2fHymY0E8UjjZXtpfXdc3jhK9OVUbXvC1v4GkyVzeGj/XueVSjJ5xB918tnSofujIg/CuKz0DY7I95NdugqPfnRPIFbq67rDDONCYdB6yygjLKrlNKGf6xS/mrr4w+4mMYmn69dLJJFOsXovgd7C5XEW6dX3hmv+rG2Vtn+PTL3mjIQG7hMURoAG5QWFOo9yDeQMcG7V+o7gug9c3AyTjcBoz0nRLXEh4Rry50VdMoWtujEV2Fy+Ub6MXiBa7neIRGjRMG+T3MY2YVguJ4Ha20yV5Ra6rc7G/9Y="
    - secure: "gOWWEMWMUnNWJmwH25wEzjcbOMhA6E/WHyNoI1QclNZFrHtUhhZXYO53lTWtAgvRZf9D0ouPmwAcE7Hgbjh/ql3ERWpsU8W0XiolCopd5zMfYp4gpxiQVdiYTyEW8WYv8mrtwQ/lHzWSij58MAsgBDML/IYdgHHvl7Ty8b2tGE3dUd+wrLsE8nZ3XohyUELnqfNAC5+qPOv3vWSL3cAVOSSAkWsrsowbpnbprpNmV18HO0dZZno3cGj3Sj9KOUTE6ceS1TSyz9oyzyZ3zp63IUkISGS6hOcMmQEU1toixO80tQG447mkRYAZlsXo6z3rjYNNvxVZsmKFxreYeBZGbOJeiW7fI8ZBin2fhuRoERYP84psB1IFEvOuBGyrHZiScZgmFPF0r75pp8we7w/3fBQq35luCnL5hJQ13V28JFDyHYUPAm5+alzUIA2hOBjYBtGVhSSevLlpQrLUdGmxqZFWumo2qXXWxsabsbwWG4oK3ixCJP1ET0rkls5BmLr1MjWLJN30miekP54O/gk23yWH0XviAbs8MOUY+Mel6TiwEF2N1X7UdjfMSrcnKknv78dfvoAFByqlT54oiZv6yzpb7cyFuQfqRWBiMDKulu6u819F5UQzE7Z+rVOQnXglPkrwuJu8ky8Lrsdd2Lfrbc6Zaz3w5+Tcixux1jbVvhQ="

services:
  - docker

before_script:
  - curl https://cli-assets.heroku.com/install.sh | sh

script:
  # Docker Build the Image
  - docker build --target test --tag my-test-image .

  # Docker Run Unit Test
  - echo "Running Unit Tests"
  - docker run my-test-image test_view_model.py

  # Docker Run Integration tests 
  - echo "Running Integration Tests"
  #- docker run my-test-image test_todoapp.py

  # Docker Run E2E 
  - echo "Running E2E Tests"
  - docker run -e trello_key=$trello_key -e trello_token=$trello_token -e trello_boardid=$trello_boardid -e todo_list_id=$todo_list_id -e doing_list_id=$doing_list_id -e done_list_id=$done_list_id my-test-image test_trello.py
      
  # Docker Build and Push 
  - docker build --target production --tag $docker_login/todoapp:latest .
  - docker login --username $docker_login --password $docker_password
  - docker push $docker_login/todoapp:latest

  # Heroku Push and Release
  - echo "Pull image from Dockerhub"
  - docker pull $docker_login/todoapp:latest

  - echo "Tag image"
  - docker tag $docker_login/todoapp:latest registry.heroku.com/rajrahmantodoapp/web

  - echo "Login to Heroku"
  - docker login --username=$heroku_login --password=$(heroku auth:token) registry.heroku.com

  - echo "Push image to Heroku"
  - docker push registry.heroku.com/rajrahmantodoapp/web

  - echo "Heroku Release to web"

deploy:
  provider: script
  script: 
      heroku container:release web --app rajrahmantodoapp

