language: generic
services:
- docker
env:
  global:
  - secure: BRlEpo2RTUWLeiXCbJn7KYX0t/7WKLDXXhg6z7bgzJCMieu8xxkGHU4ZuVFfL1MAuq70Gy7TreiO94JXD3pZS8eBWQCFDAvIF5xu4FCR6S/oLmSQ/r1ZEFi1fvMyk4fKKfGSLAHVjVUmOwOygcgIHqqPXy23G2/rFGAcvTNYWE0GQE+WMCQ3GrBk93yI3QbvbQfyePMZ/asMLyiZzaa2xe+u8SWU2EQ+RrRQaEeuiQW3oNh0bi/K8Ux9XjaJi9Y5HGkN9U32TN4/0m+TRyy6FRyYFJgR9a0C5TDLhP0eeHYT8jAqGQSA6/LbinYGuAw4Sydgxmp8zReQBMfb0125sYv3T50r0MecUjgGTBLKNRGp5xmbs8zN0LYUB7ehhpLnsLVbTpT3xZzqTexzFtXCyzmFjd6rHHD2+7SpFQyXI10THrziG7ZZaXnWXxWsoAPUl9wDur3S8UQ40Nk5GZc9L8vqqI/siK8At3/UwMd/qbarCSNhZmQIs20GMH30MizB6ALc/kYJVh4eQe/lX+2vTGPLjlWkdVdYUeBJFDGVLvgXnlPdvZZgUxscq/ucTxsg5FJG8lj1FVzXTAAdGg8zkiVAG2Ni0hmbs1+sdGWy2XVkl5DKJTjLqQwa6Yfw45ecotjLDCvDKFcaHWooWXGVbdevyJEjD5QA0RntTYltHzY=
  - secure: ghlOKmkDHR3JJtMOLinkJYLfgAAKUwc2PZTIg8g35bWu90eS/yvzfnZDF5KJh1TD+6doJrop0HsdqG57jReEutmAisjJ2sk38TY+CKZ96toJ+hDXBM5zaM7/P5SvAzA50ZGqEoT9CY7S9L4k2MPUf6Ka7eiVTr1I0a1SA8NnxpCFJSg5EzPkGAyL3U9GytoFCXegT9xCCdofz2iLLGvZMNaDbjEauDJqE7+TN8uC3fuWVcQj72eW3tVt0Ge13/KeFrCbqSrR5wSDNBiwppYtGYutuHQ1x1UYbKR+zdD5OqlspWInYkxSANoJNvTIK6nFP2ZcC5zxOOljyjMLDf5f4XzD2tHMplKw36DDtzXJJXj4cnHRH7DxfRPaVYIRckZJDI26qECduXN1h7Gqq3qP6ZKvTQqmD9deeSHgqw+puKU8d5ltB4zkfS64T1AKJ/M3JJu589Xni9EIT6uE+pSrggb4wYDHKv9NKoPAJ56tla5ikAPvBQBIImI+E1R0n6xCKMnJG8pveDPMg0d7CNDmZEr/IDBpp+g96l4uo3SbNFe8xjM/Y/5bJ/Uz+a/JegpUUVBoiTioGicIsntjc3gGQ46eAgQsTnXimbOMPJiRoSYuya2Tcoglge+b2AerwR5J/zc+d0OugDDCH0P5nZnqJR74cD3euT1KJLJU3IU13Dc=
script:
- echo $docker_password | docker login --username $docker_username --password-stdin
- docker build --target test --tag my-test-image .
- docker build --target production --tag ncaunhye/todo-app:latest .
- docker run --env-file ./.env.test my-test-image
- docker push ncaunhye/todo-app:latest 
- docker pull ncaunhye/todo-app:latest 
- docker tag ncaunhye/todo-app:latest registry.heroku.com/nadias-app/web
- docker push registry.heroku.com/nadias-app/web
notifications:
  slack:
    secure: J0u42Ts01sTJbMwXzssCmT/VwcDhY7q/y6RGdkFS42yDdVBFWReDfdOAZ3Ei2EMAEBLAfpHTPNeU++Grw+n8zzib6voHVBeuM5x4HXZfuXQVauD/Z+4QfheKIc0HhdjnQ7AX1d5MFF1W21e3in1Zj5Yx204QviBTiyMChdDkwrmZggqGg6zTfo+Ev51Y3aBPfXewS4A1Vf7G3aKflF6Dxdf1EfRo2KKkDPgw1zmFXx/G7j8Di+/cxqmASPOQ5JrgMtac1Cf4z7T5MxgekJtgAlpL667IrcqXcKLUtY35k5bkxw7d9q3ZfCTZXRq3dZvCogivFHm9MKvXZD4qmYFXKxJ72e7ONl4Ove7UM8QAA4/5OkdVUXrfdb2brOUtYUC14lLlbSpYfCKX8UreApKSgYmy08L0fP6hd3XXCWN741cttkkzwocaXX8yuuWQXDZiOlq+sm0IRpO76vMYSyk38fbR9VRh1dE3vSs+FGmOZ9oPPBneLmnbSAP9DBvNNyoKrdeJ0RozjiS/tUyCZFJxljTvZRlU08yotSSgE3qSc8FXNkOJF5NbO/R2Eng086fy4DA/lblpKCrRuTUWCF3+RgJO6TmBZXbcG6mGF/bIyzx2oCTywFfAlzFWvYn89QYzVrTzAjda6Wqrd9m7UhZHL60mOLNYIks6YpdHHtudRfE=
  email:
    recipients:
    - nadia.caunhye@kpmg.co.uk
    on_failure: always
